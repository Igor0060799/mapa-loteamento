<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurar Mapa</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #mapa-container {
            position: relative;
            display: inline-block;
            margin-top: 20px;
        }
        #mapa {
            width: 100%;
            max-width: 800px;
            border: 2px solid #ccc;
        }
        .bolinha {
            position: absolute;
            width: 10px; /* Reduzida em 50% */
            height: 10px;
            border-radius: 50%;
            border: 1px solid black;
            cursor: grab;
        }
        .verde { background-color: green; }
        .laranja { background-color: orange; }
        .vermelho { background-color: red; }
        #config-form {
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <h1>Configuração do Mapa</h1>
    <button onclick="gerarBolinha()">Gerar Bolinha</button>
    <button onclick="excluirBolinha()">Excluir Bolinha</button>

    <div id="mapa-container">
        <img id="mapa" src="implantacao.png" alt="Mapa de Implantação">
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbzL2zXBQFJq1oTUbP2jZeOvpKqJnD4NI1b_dx8vhTTD_Omp9TolsP9-CyH8db-btd7mow/exec";
        let bolinhas = [];

        function gerarBolinha() {
            let bolinha = document.createElement("div");
            bolinha.classList.add("bolinha", "verde"); // Cor padrão

            bolinha.style.left = "50%";
            bolinha.style.top = "50%";
            bolinha.draggable = true;
            bolinha.addEventListener("mousedown", iniciarArraste);

            document.getElementById("mapa-container").appendChild(bolinha);
            bolinhas.push(bolinha);
        }

        function iniciarArraste(event) {
            let bolinha = event.target;
            let shiftX = event.clientX - bolinha.getBoundingClientRect().left;
            let shiftY = event.clientY - bolinha.getBoundingClientRect().top;

            function moverBolinha(event) {
                bolinha.style.left = event.pageX - shiftX + "px";
                bolinha.style.top = event.pageY - shiftY + "px";
            }

            function soltarBolinha() {
                document.removeEventListener("mousemove", moverBolinha);
                document.removeEventListener("mouseup", soltarBolinha);
                abrirPopup(bolinha);
            }

            document.addEventListener("mousemove", moverBolinha);
            document.addEventListener("mouseup", soltarBolinha);
        }

        function abrirPopup(bolinha) {
            let quadra = prompt("Digite a quadra:");
            let lote = prompt("Digite o lote:");

            if (quadra && lote) {
                salvarCoordenadas(quadra, lote, bolinha);
            }
        }

        async function salvarCoordenadas(quadra, lote, bolinha) {
            let coordenadas = {
                quadra: quadra,
                lote: lote,
                x: bolinha.style.left,
                y: bolinha.style.top
            };

            try {
                let response = await fetch(API_URL, {
                    method: "POST",
                    body: JSON.stringify(coordenadas),
                    headers: { "Content-Type": "application/json" }
                });
                let result = await response.json();
                alert(result.mensagem || "Salvo com sucesso!");
            } catch (error) {
                console.error("Erro ao salvar:", error);
                alert("Erro ao salvar as coordenadas.");
            }
        }

        function excluirBolinha() {
            if (bolinhas.length > 0) {
                let bolinha = bolinhas.pop();
                bolinha.remove();
            }
        }
    </script>

</body>
</html>
